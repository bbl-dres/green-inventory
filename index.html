<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Grünflächeninventar GIS</title>
    
    <script src="https://api.mapbox.com/mapbox-gl-js/v3.4.0/mapbox-gl.js"></script>
    <link href="https://api.mapbox.com/mapbox-gl-js/v3.4.0/mapbox-gl.css" rel="stylesheet" />
    
    <link href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@20..48,100..700,0..1,-50..200" rel="stylesheet" />
    
    <link rel="stylesheet" href="css/tokens.css">
    <link rel="stylesheet" href="css/main.css">
</head>
<body>
    <!-- Loading overlay (shown during initial data fetch) -->
    <div id="loading-overlay" class="loading-overlay">
        <div class="loading-spinner"></div>
        <div class="loading-text">Daten werden geladen...</div>
    </div>

    <!-- Toast notification container -->
    <div id="toast-container" class="toast-container" role="alert" aria-live="polite"></div>

    <!-- Layer info modal -->
    <div id="layer-info-modal" class="layer-info-modal" role="dialog" aria-modal="true" aria-labelledby="layer-info-title">
        <div class="layer-info-modal-content">
            <button class="layer-info-modal-close" aria-label="Schliessen">
                <span class="material-symbols-outlined">close</span>
            </button>
            <div id="layer-info-content" class="layer-info-body">
                <div class="layer-info-loading">Lade Informationen...</div>
            </div>
        </div>
    </div>

    <!-- Skip link for keyboard navigation -->
    <a href="#main" class="skip-link">Zum Hauptinhalt springen</a>

    <header id="header" role="banner">
        <div class="header-main">
            <div id="logo-area">
                <img id="logo-flag" src="assets/swiss-logo-flag.svg" alt="Schweizer Flagge">
                <img id="logo-name" src="assets/swiss-logo-name.svg" alt="Schweizerische Eidgenossenschaft">
                <div id="logo-divider"></div>
                <div id="logo-text">
                    <span class="logo-line-bold">Bundesamt für Bauten und Logistik</span>
                    <span class="logo-line">Abteilung für Objektmanagement</span>
                    <span class="logo-line">Grünflächen Inventar</span>
                </div>
            </div>

            <div id="search-area" role="search">
                <div id="search-wrapper">
                    <div id="search-container">
                        <button id="search-icon-btn" aria-label="Suche starten" type="button">
                            <span class="material-symbols-outlined" aria-hidden="true">search</span>
                        </button>
                        <input type="search" id="search-input" placeholder="Suche nach Objekten, Orten oder Karten" aria-label="Suchbegriff eingeben" autocomplete="off">
                        <button id="search-clear-btn" title="Suche löschen" aria-label="Suche löschen" type="button">
                            <span class="material-symbols-outlined" aria-hidden="true">close</span>
                        </button>
                        <div id="search-spinner" class="spinner" role="status" aria-label="Suche läuft"></div>
                    </div>
                    <div id="search-results" role="listbox" aria-label="Suchergebnisse"></div>
                </div>

                <div class="view-toggle" role="tablist" aria-label="Ansicht wählen">
                    <button class="view-toggle-btn active" data-view="map" title="Karte" aria-label="Kartenansicht" role="tab" aria-selected="true">
                        <span class="material-symbols-outlined" aria-hidden="true">map</span>
                        <span class="view-label">Karte</span>
                    </button>
                    <button class="view-toggle-btn" data-view="wiki" title="Wiki" aria-label="Pflegeprofile Wiki" role="tab" aria-selected="false">
                        <span class="material-symbols-outlined" aria-hidden="true">menu_book</span>
                        <span class="view-label">Wiki</span>
                    </button>
                    <button class="view-toggle-btn" data-view="tasks" title="Aufgaben" aria-label="Aufgabenverwaltung" role="tab" aria-selected="false">
                        <span class="material-symbols-outlined" aria-hidden="true">task_alt</span>
                        <span class="view-label">Aufgaben</span>
                    </button>
                    <button class="view-toggle-btn" data-view="dashboard" title="Dashboard" aria-label="Dashboard" role="tab" aria-selected="false">
                        <span class="material-symbols-outlined" aria-hidden="true">bar_chart_4_bars</span>
                        <span class="view-label">Dashboard</span>
                    </button>
                </div>
            </div>

            <div id="header-right">
                <span id="object-count" aria-live="polite">10 Standorte</span>
                <button class="header-btn" id="smart-drawer-btn" title="Standorte filtern" aria-label="Standorte filtern" aria-expanded="false" aria-controls="smart-drawer">
                    <span class="material-symbols-outlined" aria-hidden="true">tune</span>
                    Standorte filtern
                </button>
                <button class="header-btn" id="project-settings-btn" title="Projekteinstellungen" aria-label="Projekteinstellungen">
                    <span class="material-symbols-outlined" aria-hidden="true">settings</span>
                </button>
                <div id="login-area">
                    <button id="login-btn" title="Anmelden" aria-label="Anmelden">
                        <span class="material-symbols-outlined" aria-hidden="true">person</span>
                    </button>
                </div>
            </div>
        </div>

    </header>

    <main id="main">
        <div class="main-content">
            <div id="map-view" class="active">
            <div id="map"></div>


            <!-- Edit Banner (top-center warning when editing) -->
            <div class="edit-banner" id="edit-banner">
                <span class="material-symbols-outlined">edit</span>
                <span id="edit-banner-layer-name">Grünflächen bearbeiten</span>
                <div class="edit-banner-actions">
                    <button class="edit-banner-btn edit-banner-cancel" id="edit-banner-cancel">Abbrechen</button>
                    <button class="edit-banner-btn edit-banner-save" id="edit-banner-save">Speichern</button>
                </div>
            </div>

            <!-- Edit Toolbar (shown when editing a layer) -->
            <div class="edit-toolbar" id="edit-toolbar">
                <div class="edit-toolbar-tools">
                    <div class="edit-tool-group">
                        <button class="edit-tool-btn" data-tool="draw-polygon" title="Polygon zeichnen">
                            <span class="material-symbols-outlined">pentagon</span>
                            <span class="edit-tool-label">Polygon</span>
                        </button>
                        <button class="edit-tool-btn" data-tool="draw-point" title="Punkt setzen">
                            <span class="material-symbols-outlined">location_on</span>
                            <span class="edit-tool-label">Punkt</span>
                        </button>
                        <button class="edit-tool-btn" data-tool="draw-line" title="Linie zeichnen">
                            <span class="material-symbols-outlined">timeline</span>
                            <span class="edit-tool-label">Linie</span>
                        </button>
                    </div>
                    <div class="edit-tool-divider"></div>
                    <div class="edit-tool-group">
                        <button class="edit-tool-btn" data-tool="edit-vertices" title="Stützpunkte bearbeiten">
                            <span class="material-symbols-outlined">edit</span>
                            <span class="edit-tool-label">Bearbeiten</span>
                        </button>
                        <button class="edit-tool-btn" data-tool="split" title="Polygon teilen">
                            <span class="material-symbols-outlined">content_cut</span>
                            <span class="edit-tool-label">Teilen</span>
                        </button>
                        <button class="edit-tool-btn" data-tool="merge" title="Zusammenführen">
                            <span class="material-symbols-outlined">join</span>
                            <span class="edit-tool-label">Verbinden</span>
                        </button>
                        <button class="edit-tool-btn" data-tool="delete" title="Löschen">
                            <span class="material-symbols-outlined">delete</span>
                            <span class="edit-tool-label">Löschen</span>
                        </button>
                    </div>
                    <div class="edit-tool-divider"></div>
                    <div class="edit-tool-group">
                        <button class="edit-tool-btn" data-tool="undo" title="Rückgängig">
                            <span class="material-symbols-outlined">undo</span>
                            <span class="edit-tool-label">Undo</span>
                        </button>
                        <button class="edit-tool-btn" data-tool="redo" title="Wiederholen">
                            <span class="material-symbols-outlined">redo</span>
                            <span class="edit-tool-label">Redo</span>
                        </button>
                    </div>
                </div>
            </div>

            <nav id="accordion-panel">
                <div class="accordion-item">
                    <div class="accordion-header">
                        <span class="accordion-arrow"><span class="material-symbols-outlined">chevron_right</span></span>
                        <span>Teilen</span>
                    </div>
                    <div class="accordion-content">
                        <div class="share-panel">
                            <div class="share-icons" role="group" aria-label="Teilen über soziale Medien">
                                <!-- Email -->
                                <button class="share-icon-btn" onclick="shareViaEmail()" title="Per E-Mail teilen" aria-label="Per E-Mail teilen">
                                    <svg viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg" aria-hidden="true">
                                        <path d="M20 4H4c-1.1 0-1.99.9-1.99 2L2 18c0 1.1.9 2 2 2h16c1.1 0 2-.9 2-2V6c0-1.1-.9-2-2-2zm0 4l-8 5-8-5V6l8 5 8-5v2z"/>
                                    </svg>
                                </button>
                                <!-- Facebook -->
                                <button class="share-icon-btn" onclick="shareViaFacebook()" title="Auf Facebook teilen" aria-label="Auf Facebook teilen">
                                    <svg viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg" aria-hidden="true">
                                        <path d="M22 12c0-5.52-4.48-10-10-10S2 6.48 2 12c0 4.84 3.44 8.87 8 9.8V15H8v-3h2V9.5C10 7.57 11.57 6 13.5 6H16v3h-2c-.55 0-1 .45-1 1v2h3v3h-3v6.95c5.05-.5 9-4.76 9-9.95z"/>
                                    </svg>
                                </button>
                                <!-- LinkedIn -->
                                <button class="share-icon-btn" onclick="shareViaLinkedIn()" title="Auf LinkedIn teilen" aria-label="Auf LinkedIn teilen">
                                    <svg viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg" aria-hidden="true">
                                        <path d="M19 3a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h14m-.5 15.5v-5.3a3.26 3.26 0 0 0-3.26-3.26c-.85 0-1.84.52-2.32 1.3v-1.11h-2.79v8.37h2.79v-4.93c0-.77.62-1.4 1.39-1.4a1.4 1.4 0 0 1 1.4 1.4v4.93h2.79M6.88 8.56a1.68 1.68 0 0 0 1.68-1.68c0-.93-.75-1.69-1.68-1.69a1.69 1.69 0 0 0-1.69 1.69c0 .93.76 1.68 1.69 1.68m1.39 9.94v-8.37H5.5v8.37h2.77z"/>
                                    </svg>
                                </button>
                                <!-- X (Twitter) -->
                                <button class="share-icon-btn" onclick="shareViaX()" title="Auf X teilen" aria-label="Auf X teilen">
                                    <svg viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg" aria-hidden="true">
                                        <path d="M18.244 2.25h3.308l-7.227 8.26 8.502 11.24H16.17l-5.214-6.817L4.99 21.75H1.68l7.73-8.835L1.254 2.25H8.08l4.713 6.231zm-1.161 17.52h1.833L7.084 4.126H5.117z"/>
                                    </svg>
                                </button>
                            </div>
                            <div class="share-link-section">
                                <span class="share-link-label">Link zum Teilen:</span>
                                <div class="share-link-row">
                                    <input type="text" id="share-link-input" class="share-link-input" readonly aria-label="Link zum Teilen">
                                    <button class="share-copy-btn" onclick="copyShareLink()" aria-label="Link in die Zwischenablage kopieren">Link kopieren</button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="accordion-item">
                    <div class="accordion-header">
                        <span class="accordion-arrow"><span class="material-symbols-outlined">chevron_right</span></span>
                        <span>Drucken</span>
                    </div>
                    <div class="accordion-content">
                        <div class="print-panel">
                            <div class="print-form-row">
                                <label for="print-orientation" class="print-label">Orientierung</label>
                                <select id="print-orientation" class="print-select">
                                    <option value="landscape-a4">A4 landscape</option>
                                    <option value="portrait-a4">A4 portrait</option>
                                    <option value="landscape-a3">A3 landscape</option>
                                    <option value="portrait-a3">A3 portrait</option>
                                </select>
                            </div>
                            <div class="print-form-row">
                                <label for="print-scale" class="print-label">Massstab</label>
                                <select id="print-scale" class="print-select">
                                    <option value="auto">Automatisch</option>
                                    <option value="500">1:500</option>
                                    <option value="1000">1:1'000</option>
                                    <option value="2500">1:2'500</option>
                                    <option value="5000">1:5'000</option>
                                    <option value="10000">1:10'000</option>
                                    <option value="25000">1:25'000</option>
                                    <option value="50000">1:50'000</option>
                                    <option value="100000">1:100'000</option>
                                    <option value="200000">1:200'000</option>
                                    <option value="500000">1:500'000</option>
                                    <option value="1000000">1:1'000'000</option>
                                    <option value="2500000">1:2'500'000</option>
                                </select>
                            </div>
                            <div class="print-checkboxes">
                                <label class="print-checkbox-label">
                                    <input type="checkbox" id="print-legend" checked>
                                    <span>Legende</span>
                                </label>
                                <label class="print-checkbox-label">
                                    <input type="checkbox" id="print-grid">
                                    <span>Koordinatennetz</span>
                                </label>
                            </div>
                            <button id="print-pdf-btn" class="print-btn" onclick="generatePrintPDF()">
                                Erstelle PDF für Druck
                            </button>
                        </div>
                    </div>
                </div>

                <div class="accordion-item">
                    <div class="accordion-header">
                        <span class="accordion-arrow"><span class="material-symbols-outlined">chevron_right</span></span>
                        <span>Zeichnen & Messen auf der Karte</span>
                    </div>
                    <div class="accordion-content">
                        Zeichnen Sie Punkte, Linien und Polygone direkt auf der Karte. Messen Sie Distanzen in Metern oder Kilometern und berechnen Sie Flächen in Quadratmetern.
                    </div>
                </div>

                <div class="accordion-item">
                    <div class="accordion-header">
                        <span class="accordion-arrow"><span class="material-symbols-outlined">chevron_right</span></span>
                        <span>Export</span>
                    </div>
                    <div class="accordion-content">
                        <div class="export-panel">
                            <div class="export-section">
                                <label class="export-section-label">Datenauswahl</label>
                                <select id="export-data-selection" class="export-select">
                                    <option value="filtered">Aktuelle Ansicht</option>
                                    <option value="all">Alle Objekte</option>
                                    <option value="selected">Nur ausgewähltes Objekt</option>
                                </select>
                                <span class="export-count" id="export-count"></span>
                            </div>

                            <div class="export-section">
                                <label class="export-section-label">Format wählen</label>
                                <div class="export-format-grid">
                                    <button class="export-format-card active" data-format="geojson">
                                        <span class="export-format-icon">{ }</span>
                                        <span class="export-format-name">GeoJSON</span>
                                        <span class="export-format-desc">Web-Anwendungen</span>
                                    </button>
                                    <button class="export-format-card" data-format="csv">
                                        <span class="export-format-icon"><span class="material-symbols-outlined">table_view</span></span>
                                        <span class="export-format-name">CSV</span>
                                        <span class="export-format-desc">Excel / Tabellen</span>
                                    </button>
                                    <button class="export-format-card" data-format="kml">
                                        <span class="export-format-icon"><span class="material-symbols-outlined">location_on</span></span>
                                        <span class="export-format-name">KML</span>
                                        <span class="export-format-desc">Google Earth</span>
                                    </button>
                                    <button class="export-format-card" data-format="shapefile">
                                        <span class="export-format-icon"><span class="material-symbols-outlined">hexagon</span></span>
                                        <span class="export-format-name">Shapefile</span>
                                        <span class="export-format-desc">GIS-Software</span>
                                    </button>
                                </div>
                            </div>

                            <div class="export-section">
                                <label class="export-section-label">Optionen</label>
                                <div class="export-options">
                                    <label class="export-checkbox-label">
                                        <input type="checkbox" id="export-coords" checked>
                                        <span>Koordinaten einschliessen</span>
                                    </label>
                                    <label class="export-checkbox-label">
                                        <input type="checkbox" id="export-all-fields" checked>
                                        <span>Alle Attribute exportieren</span>
                                    </label>
                                    <label class="export-checkbox-label">
                                        <input type="checkbox" id="export-visible-only">
                                        <span>Nur sichtbare Spalten</span>
                                    </label>
                                    <label class="export-checkbox-label">
                                        <input type="checkbox" id="export-parcels">
                                        <span>Parzellen einschliessen</span>
                                    </label>
                                </div>
                            </div>

                            <div class="export-section">
                                <label class="export-section-label">Koordinatensystem</label>
                                <select id="export-crs" class="export-select">
                                    <option value="EPSG:4326">WGS 84 (EPSG:4326)</option>
                                    <option value="EPSG:2056">CH1903+ / LV95 (EPSG:2056)</option>
                                    <option value="EPSG:21781">CH1903 / LV03 (EPSG:21781)</option>
                                </select>
                            </div>

                            <button id="export-btn" class="export-btn">
                                <span class="material-symbols-outlined">download</span>
                                <span>Exportieren</span>
                            </button>
                        </div>
                    </div>
                </div>

                <div class="accordion-item" id="geokatalog-accordion">
                    <div class="accordion-header geokatalog-header">
                        <span class="accordion-arrow"><span class="material-symbols-outlined">chevron_right</span></span>
                        <span>Geokatalog</span>
                        <span class="geokatalog-theme-switch">Thema wechseln</span>
                    </div>
                    <div class="accordion-content geokatalog-content">
                        <div id="geokatalog-tree" class="geokatalog-tree">
                            <div class="geokatalog-loading">Lade Katalog...</div>
                        </div>
                    </div>
                </div>

                <div class="accordion-item" id="active-layers-accordion">
                    <div class="accordion-header active">
                        <span class="accordion-arrow"><span class="material-symbols-outlined">chevron_right</span></span>
                        <span>Dargestellte Karten</span>
                    </div>
                    <div class="accordion-content show" id="dargestellte-karten-content">
                        <!-- Interne Daten (project layers, ordered top=frontmost on map) -->
                        <!-- Z-order: Points > Lines > Small polygons > Large polygons > Reference -->
                        <div class="layer-group-label">Interne Daten</div>

                        <!-- Objekte (Point) -->
                        <div class="layer-item" data-layer="trees">
                            <input type="checkbox" id="layer-trees" data-layer="trees" checked>
                            <span class="layer-name">Bäume</span>
                            <div class="layer-actions">
                                <button class="layer-edit-btn" data-layer="trees" title="Bäume bearbeiten">
                                    <span class="material-symbols-outlined">edit</span>
                                </button>
                                <button class="layer-info-btn" data-layer="trees" title="Layer-Info">
                                    <span class="material-symbols-outlined">info</span>
                                </button>
                            </div>
                        </div>
                        <div class="layer-item" data-layer="furniture">
                            <input type="checkbox" id="layer-furniture" data-layer="furniture" checked>
                            <span class="layer-name">Mobiliar</span>
                            <div class="layer-actions">
                                <button class="layer-edit-btn" data-layer="furniture" title="Mobiliar bearbeiten">
                                    <span class="material-symbols-outlined">edit</span>
                                </button>
                                <button class="layer-info-btn" data-layer="furniture" title="Layer-Info">
                                    <span class="material-symbols-outlined">info</span>
                                </button>
                            </div>
                        </div>
                        <div class="layer-item" data-layer="structure-elements">
                            <input type="checkbox" id="layer-structure-elements" data-layer="structure-elements" checked>
                            <span class="layer-name">Strukturelemente</span>
                            <div class="layer-actions">
                                <button class="layer-edit-btn" data-layer="structure-elements" title="Strukturelemente bearbeiten">
                                    <span class="material-symbols-outlined">edit</span>
                                </button>
                                <button class="layer-info-btn" data-layer="structure-elements" title="Layer-Info">
                                    <span class="material-symbols-outlined">info</span>
                                </button>
                            </div>
                        </div>

                        <!-- Linienobjekte (LineString) -->
                        <div class="layer-item" data-layer="linear-features">
                            <input type="checkbox" id="layer-linear-features" data-layer="linear-features" checked>
                            <span class="layer-name">Linienobjekte</span>
                            <div class="layer-actions">
                                <button class="layer-edit-btn" data-layer="linear-features" title="Linienobjekte bearbeiten">
                                    <span class="material-symbols-outlined">edit</span>
                                </button>
                                <button class="layer-info-btn" data-layer="linear-features" title="Layer-Info">
                                    <span class="material-symbols-outlined">info</span>
                                </button>
                            </div>
                        </div>

                        <!-- Flächen klein (Polygon) -->
                        <div class="layer-item" data-layer="water-features">
                            <input type="checkbox" id="layer-water-features" data-layer="water-features" checked>
                            <span class="layer-name">Gewässer</span>
                            <div class="layer-actions">
                                <button class="layer-edit-btn" data-layer="water-features" title="Gewässer bearbeiten">
                                    <span class="material-symbols-outlined">edit</span>
                                </button>
                                <button class="layer-info-btn" data-layer="water-features" title="Layer-Info">
                                    <span class="material-symbols-outlined">info</span>
                                </button>
                            </div>
                        </div>
                        <div class="layer-item" data-layer="surfaces">
                            <input type="checkbox" id="layer-surfaces" data-layer="surfaces" checked>
                            <span class="layer-name">Belagsflächen</span>
                            <div class="layer-actions">
                                <button class="layer-edit-btn" data-layer="surfaces" title="Belagsflächen bearbeiten">
                                    <span class="material-symbols-outlined">edit</span>
                                </button>
                                <button class="layer-info-btn" data-layer="surfaces" title="Layer-Info">
                                    <span class="material-symbols-outlined">info</span>
                                </button>
                            </div>
                        </div>

                        <!-- Vegetation (Polygon) -->
                        <div class="layer-item" data-layer="plantings">
                            <input type="checkbox" id="layer-plantings" data-layer="plantings" checked>
                            <span class="layer-name">Stauden & Pflanzungen</span>
                            <div class="layer-actions">
                                <button class="layer-edit-btn" data-layer="plantings" title="Stauden & Pflanzungen bearbeiten">
                                    <span class="material-symbols-outlined">edit</span>
                                </button>
                                <button class="layer-info-btn" data-layer="plantings" title="Layer-Info">
                                    <span class="material-symbols-outlined">info</span>
                                </button>
                            </div>
                        </div>
                        <div class="layer-item" data-layer="building-greenery">
                            <input type="checkbox" id="layer-building-greenery" data-layer="building-greenery" checked>
                            <span class="layer-name">Gebäude-/Ausstattungsbegrünung</span>
                            <div class="layer-actions">
                                <button class="layer-edit-btn" data-layer="building-greenery" title="Gebäudebegrünung bearbeiten">
                                    <span class="material-symbols-outlined">edit</span>
                                </button>
                                <button class="layer-info-btn" data-layer="building-greenery" title="Layer-Info">
                                    <span class="material-symbols-outlined">info</span>
                                </button>
                            </div>
                        </div>
                        <div class="layer-item" data-layer="lawns">
                            <input type="checkbox" id="layer-lawns" data-layer="lawns" checked>
                            <span class="layer-name">Rasen & Wiesen</span>
                            <div class="layer-actions">
                                <button class="layer-edit-btn" data-layer="lawns" title="Rasen & Wiesen bearbeiten">
                                    <span class="material-symbols-outlined">edit</span>
                                </button>
                                <button class="layer-info-btn" data-layer="lawns" title="Layer-Info">
                                    <span class="material-symbols-outlined">info</span>
                                </button>
                            </div>
                        </div>
                        <div class="layer-item" data-layer="gardens">
                            <input type="checkbox" id="layer-gardens" data-layer="gardens" checked>
                            <span class="layer-name">Gärten</span>
                            <div class="layer-actions">
                                <button class="layer-edit-btn" data-layer="gardens" title="Gärten bearbeiten">
                                    <span class="material-symbols-outlined">edit</span>
                                </button>
                                <button class="layer-info-btn" data-layer="gardens" title="Layer-Info">
                                    <span class="material-symbols-outlined">info</span>
                                </button>
                            </div>
                        </div>
                        <div class="layer-item" data-layer="external-areas">
                            <input type="checkbox" id="layer-external-areas" data-layer="external-areas" checked>
                            <span class="layer-name">Externe Bewirtschaftung</span>
                            <div class="layer-actions">
                                <button class="layer-edit-btn" data-layer="external-areas" title="Externe Bewirtschaftung bearbeiten">
                                    <span class="material-symbols-outlined">edit</span>
                                </button>
                                <button class="layer-info-btn" data-layer="external-areas" title="Layer-Info">
                                    <span class="material-symbols-outlined">info</span>
                                </button>
                            </div>
                        </div>

                        <!-- Bestockte Flächen (Polygon, large) -->
                        <div class="layer-item" data-layer="woodlands">
                            <input type="checkbox" id="layer-woodlands" data-layer="woodlands" checked>
                            <span class="layer-name">Gehölze & Parkwald</span>
                            <div class="layer-actions">
                                <button class="layer-edit-btn" data-layer="woodlands" title="Gehölze & Parkwald bearbeiten">
                                    <span class="material-symbols-outlined">edit</span>
                                </button>
                                <button class="layer-info-btn" data-layer="woodlands" title="Layer-Info">
                                    <span class="material-symbols-outlined">info</span>
                                </button>
                            </div>
                        </div>
                        <div class="layer-item" data-layer="forest">
                            <input type="checkbox" id="layer-forest" data-layer="forest" checked>
                            <span class="layer-name">Wald</span>
                            <div class="layer-actions">
                                <button class="layer-edit-btn" data-layer="forest" title="Wald bearbeiten">
                                    <span class="material-symbols-outlined">edit</span>
                                </button>
                                <button class="layer-info-btn" data-layer="forest" title="Layer-Info">
                                    <span class="material-symbols-outlined">info</span>
                                </button>
                            </div>
                        </div>

                        <!-- Referenz-Layer (read-only, background) -->
                        <div class="layer-item" data-layer="portfolio">
                            <input type="checkbox" id="layer-portfolio" data-layer="portfolio" checked>
                            <span class="layer-name">Standorte</span>
                            <div class="layer-actions">
                                <button class="layer-info-btn" data-layer="portfolio" title="Layer-Info">
                                    <span class="material-symbols-outlined">info</span>
                                </button>
                            </div>
                        </div>
                        <div class="layer-item" data-layer="parcels">
                            <input type="checkbox" id="layer-parcels" data-layer="parcels" checked>
                            <span class="layer-name">Grundstücke</span>
                            <div class="layer-actions">
                                <button class="layer-info-btn" data-layer="parcels" title="Layer-Info">
                                    <span class="material-symbols-outlined">info</span>
                                </button>
                            </div>
                        </div>
                        <div class="layer-divider"></div>
                        <!-- Referenzdaten (swisstopo layers) -->
                        <div class="layer-group-label">Referenzdaten</div>
                        <div id="reference-layers-list"></div>
                    </div>
                </div>
            </nav>
            
            <div id="menu-toggle">
                <span class="material-symbols-outlined">expand_less</span>
                <span id="menu-toggle-text">Menü schliessen</span>
            </div>
            
            <aside id="info-panel" role="complementary" aria-label="Objektinformation">
                <div id="info-header">
                    <span id="info-header-title">Objekt-Information</span>
                    <div id="info-header-actions">
                        <button id="info-zoom-to" title="Hinzoomen" aria-label="Zum Objekt zoomen"><span class="material-symbols-outlined" aria-hidden="true">center_focus_strong</span></button>
                        <button id="info-share" title="Teilen" aria-label="Objekt teilen"><span class="material-symbols-outlined" aria-hidden="true">share</span></button>
                        <button id="info-close" title="Schliessen" aria-label="Informationspanel schliessen"><span class="material-symbols-outlined" aria-hidden="true">close</span></button>
                    </div>
                </div>
                <div id="info-preview-image" role="img" aria-label="Vorschaubild des Objekts"></div>
                <div id="info-body"></div>
            </aside>

            <!-- Style Switcher (visible only in map view) -->
            <div class="style-switcher" id="style-switcher">
                <div class="style-switcher-panel" id="style-panel">
                    <button class="style-option active" data-style="light-v11" title="Light">
                        <img id="thumb-light-v11" src="" alt="Light">
                        <span>Light</span>
                    </button>
                    <button class="style-option" data-style="streets-v12" title="Standard">
                        <img id="thumb-streets-v12" src="" alt="Standard">
                        <span>Standard</span>
                    </button>
                    <button class="style-option" data-style="satellite-v9" title="Luftbild">
                        <img id="thumb-satellite-v9" src="" alt="Luftbild">
                        <span>Luftbild</span>
                    </button>
                    <button class="style-option" data-style="satellite-streets-v12" title="Luftbild + Strassen">
                        <img id="thumb-satellite-streets-v12" src="" alt="Luftbild + Strassen">
                        <span>Hybrid</span>
                    </button>
                </div>
                <button class="style-switcher-btn" id="style-switcher-btn" title="Hintergrund wechseln">
                    <img id="current-style-thumb" src="" alt="Aktueller Stil">
                    <span>Hintergrund</span>
                </button>
            </div>

            <!-- Map Context Menu (Right-Click) -->
            <div id="map-context-menu" class="map-context-menu">
                <div class="context-menu-item context-menu-coords" id="context-menu-coords" title="Klicken zum Kopieren">
                    <span id="context-menu-coords-text">47.37623, 8.53048</span>
                </div>
                <div class="context-menu-item" id="context-menu-share">
                    <span>Teilen</span>
                </div>
                <div class="context-menu-item" id="context-menu-measure">
                    <span id="context-menu-measure-text">Distanz messen</span>
                </div>
                <div class="context-menu-item" id="context-menu-print">
                    <span>Drucken</span>
                </div>
                <div class="context-menu-item" id="context-menu-report">
                    <span>Problem melden</span>
                </div>
            </div>

            <!-- Measure Distance Display -->
            <div id="measure-distance-display" class="measure-distance-display">
                <div class="measure-distance-header">
                    <span class="material-symbols-outlined">straighten</span>
                    <span>Distanz messen</span>
                    <button id="measure-distance-close" class="measure-distance-close" title="Schliessen">
                        <span class="material-symbols-outlined">close</span>
                    </button>
                </div>
                <div class="measure-distance-info">
                    Klicken Sie auf die Karte, um einen Pfad zu zeichnen.
                </div>
                <div class="measure-distance-result" id="measure-distance-result">
                    <div class="measure-result-row">
                        <span class="measure-result-label">Gesamtdistanz:</span>
                        <span class="measure-result-value" id="measure-total-distance">0 m</span>
                    </div>
                    <div class="measure-result-row" id="measure-area-row" style="display: none;">
                        <span class="measure-result-label">Fläche:</span>
                        <span class="measure-result-value" id="measure-total-area">0 m²</span>
                    </div>
                </div>
            </div>
        </div>

        <div id="wiki-view">
            <div class="placeholder-view">
                <span class="material-symbols-outlined placeholder-icon">menu_book</span>
                <h2>Pflegeprofil-Wiki</h2>
                <p>Hier werden die Pflegeprofile gemäss Profilkatalog dargestellt.</p>
            </div>
        </div>

        <div id="tasks-view">
            <div class="placeholder-view">
                <span class="material-symbols-outlined placeholder-icon">task_alt</span>
                <h2>Aufgaben</h2>
                <p>Hier wird die Massnahmenplanung und Aufgabenverwaltung dargestellt.</p>
            </div>
        </div>

        <div id="dashboard-view">
            <div class="placeholder-view">
                <span class="material-symbols-outlined placeholder-icon">bar_chart_4_bars</span>
                <h2>Dashboard</h2>
                <p>Hier werden die wichtigsten KPIs und Kennzahlen dargestellt.</p>
            </div>
        </div>

        <div id="settings-view">
            <div class="placeholder-view">
                <span class="material-symbols-outlined placeholder-icon">settings</span>
                <h2>Einstellungen</h2>
                <p>Hier werden die Projekteinstellungen und Konfigurationen verwaltet.</p>
            </div>
        </div>

        <div id="api-view">
            <div class="placeholder-view">
                <span class="material-symbols-outlined placeholder-icon">api</span>
                <h2>Green Area Inventory API</h2>
                <p>Die REST-API-Dokumentation (OpenAPI / Swagger) wird hier verfügbar sein, sobald das Backend implementiert ist.</p>
                <div class="api-placeholder-endpoints">
                    <div class="api-endpoint-group">
                        <h4>Geplante Endpunkte</h4>
                        <div class="api-endpoint"><span class="api-method get">GET</span> /api/v1/sites</div>
                        <div class="api-endpoint"><span class="api-method get">GET</span> /api/v1/green-areas</div>
                        <div class="api-endpoint"><span class="api-method get">GET</span> /api/v1/trees</div>
                        <div class="api-endpoint"><span class="api-method get">GET</span> /api/v1/furniture</div>
                        <div class="api-endpoint"><span class="api-method post">POST</span> /api/v1/trees</div>
                        <div class="api-endpoint"><span class="api-method put">PUT</span> /api/v1/trees/:id</div>
                        <div class="api-endpoint"><span class="api-method delete">DEL</span> /api/v1/trees/:id</div>
                    </div>
                </div>
            </div>
        </div>

        </div><!-- /.main-content -->

        <!-- Smart Drawer (merged Filter + AI Assistant) -->
        <aside id="smart-drawer" role="complementary" aria-label="Smart Drawer">
            <div class="smart-drawer-resize-handle" title="Grösse ändern"></div>
            <div class="smart-drawer-header">
                <div class="smart-drawer-title">
                    <span class="material-symbols-outlined">filter_list</span>
                    Standorte filtern
                </div>
                <div class="smart-drawer-actions">
                    <button class="smart-drawer-btn" id="drawer-reset-btn" title="Filter zurücksetzen">
                        <span class="material-symbols-outlined">replay</span>
                    </button>
                    <button class="smart-drawer-btn" id="drawer-close-btn" title="Schliessen">
                        <span class="material-symbols-outlined">close</span>
                    </button>
                </div>
            </div>

            <!-- Filter Content -->
            <div class="smart-drawer-content" id="drawer-filter-content" data-drawer-content="filter" role="tabpanel">
                <div class="filter-section open" data-filter="status">
                    <div class="filter-section-header">
                        <span class="filter-section-title">Status</span>
                        <span class="filter-section-arrow"><span class="material-symbols-outlined">expand_more</span></span>
                    </div>
                    <div class="filter-section-content" id="filter-status-options">
                        <!-- Options populated dynamically -->
                    </div>
                </div>

                <div class="filter-section open" data-filter="eigentum">
                    <div class="filter-section-header">
                        <span class="filter-section-title">Art Eigentum</span>
                        <span class="filter-section-arrow"><span class="material-symbols-outlined">expand_more</span></span>
                    </div>
                    <div class="filter-section-content" id="filter-eigentum-options">
                        <!-- Options populated dynamically -->
                    </div>
                </div>

                <div class="filter-section open" data-filter="teilportfolio">
                    <div class="filter-section-header">
                        <span class="filter-section-title">Teilportfolio</span>
                        <span class="filter-section-arrow"><span class="material-symbols-outlined">expand_more</span></span>
                    </div>
                    <div class="filter-section-content" id="filter-teilportfolio-options">
                        <!-- Options populated dynamically -->
                    </div>
                </div>

                <div class="filter-section open" data-filter="gebaeudeart">
                    <div class="filter-section-header">
                        <span class="filter-section-title">Gebäudeart</span>
                        <span class="filter-section-arrow"><span class="material-symbols-outlined">expand_more</span></span>
                    </div>
                    <div class="filter-section-content" id="filter-gebaeudeart-options">
                        <!-- Options populated dynamically -->
                    </div>
                </div>

                <div class="filter-section open" data-filter="land">
                    <div class="filter-section-header">
                        <span class="filter-section-title">Land</span>
                        <span class="filter-section-arrow"><span class="material-symbols-outlined">expand_more</span></span>
                    </div>
                    <div class="filter-section-content" id="filter-land-options">
                        <!-- Options populated dynamically -->
                    </div>
                </div>

                <div class="filter-section open" data-filter="region">
                    <div class="filter-section-header">
                        <span class="filter-section-title">Region</span>
                        <span class="filter-section-arrow"><span class="material-symbols-outlined">expand_more</span></span>
                    </div>
                    <div class="filter-section-content" id="filter-region-options">
                        <!-- Options populated dynamically -->
                    </div>
                </div>
            </div>

        </aside>
    </main>

    <footer id="footer">
        <div id="coordinates">WGS 84 | Koordinaten: --</div>
        <div id="footer-links">
            <a href="#" id="footer-api-link">API</a>
            <a href="https://github.com/davras5/gis-immo" target="_blank">Quellcode</a>
            <a href="https://www.admin.ch/gov/de/start/rechtliches.html" target="_blank">Rechtliches</a>
            <a href="https://www.bbl.admin.ch/de/hilfe" target="_blank">Hilfe</a>
            <a href="https://www.bbl.admin.ch/de/kontakt" target="_blank">Kontakt</a>
        </div>
    </footer>

    <script src="js/app.js"></script>
</body>
</html>
